#include <Servo.h>

// Constants
const int pulsePin = A0;    // Analog input pin for pulse sensor
const int threshold = 80;   // Threshold blood rate value
const int servoPin = 9;     // Digital output pin for servo motor
const int servoOpenAngle = 90;   // Angle to open syringe for drug delivery
const int servoCloseAngle = 0;   // Angle to close syringe after drug delivery

// Variables
int pulseValue = 0;         // Current blood rate value
bool cureAdministered = false;  // Flag to track if cure has been administered

Servo syringeServo;        // Create a servo object to control the syringe

void setup() {
  Serial.begin(9600);      // Initialize serial communication
  pinMode(pulsePin, INPUT);  // Set pulse pin as input
  pinMode(servoPin, OUTPUT); // Set servo pin as output
  syringeServo.attach(servoPin);  // Attach servo to its pin
}

void loop() {
  // Read pulse sensor value
  pulseValue = analogRead(pulsePin);
  
  // Check if blood rate exceeds threshold
  if (pulseValue > threshold && !cureAdministered) {
    administerCure();
    cureAdministered = true;
  }
  
  // Reset flag if blood rate drops below threshold
  if (pulseValue <= threshold) {
    cureAdministered = false;
  }
  
  // Print pulse value for debugging
  Serial.print("Pulse value: ");
  Serial.println(pulseValue);
  
  delay(1000);  // Delay for stability
}

void administerCure() {
  // Open syringe to administer cure
  syringeServo.write(servoOpenAngle);
  delay(1000);  // Wait for drug delivery
  
  // Close syringe after drug delivery
  syringeServo.write(servoCloseAngle);
}


